#!/usr/bin/env node

/**
 * Module dependencies/
 */
var fs = require( 'fs' ),
	path = require( 'path' ),
	keysPath = path.resolve( __dirname, '..', '..', 'config', 'client.json' ),
	keys = JSON.parse( fs.readFileSync( keysPath, 'utf8' ) ),
	data = require( 'config/reader' )( {
		env: process.env.CALYPSO_ENV || 'development',
		secrets: false
	} ),
	obj = {};

keys.forEach( function( key ) {
	if ( key in data ) {
		obj[ key ] = data[ key ];
	}
} );

console.log( '/* This file is automatically generated. Do not edit manually. */' );
console.log();
console.log( 'var data = %s;', JSON.stringify( obj, null, 2 ) );
console.log( config.toString() );
console.log( isEnabled.toString() );
console.log( anyEnabled.toString() );
console.log( 'module.exports = config;' );
console.log( 'module.exports.isEnabled = isEnabled;' );
console.log( 'module.exports.anyEnabled = anyEnabled;' );

function config( key ) {
	if ( key in data ) {
		return data[ key ];
	}
	throw new Error( 'config key `' + key + '` does not exist' );
}

function isEnabled( feature ) {
	return !! data.features[ feature ];
}

function anyEnabled() {
	var args = Array.prototype.slice.call( arguments );
	return args.some( function( feature ) {
		return !! data.features[ feature ];
	} );
}
